"use strict";var tabito=(()=>{var x=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var Y=(t,n)=>{for(var r in n)x(t,r,{get:n[r],enumerable:!0})},I=(t,n,r,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of A(n))!W.call(t,s)&&s!==r&&x(t,s,{get:()=>n[s],enumerable:!(e=F(n,s))||e.enumerable});return t};var N=t=>I(x({},"__esModule",{value:!0}),t);var B={};Y(B,{_findGreedyPath:()=>b,chunkInput:()=>X,sentenceToGraph:()=>_});function u(t,n,r,e=!1){n in t||(t[n]=[]),(!e||!t[n].includes(r))&&t[n].push(r)}function k(t){let n={};for(let r in t)for(let e of t[r])u(n,e,r);return n}function E(t){let n={};for(let r in t)for(let e of t[r]){if(e in n)throw new Error("non-unique values");n[e]=r}return n}function K(t,n){let r=[],e=-1;for(;(e=t.indexOf(n,e+1))>=0;)r.push(e);return r}function M(t,n){if(t.length===0)throw new Error("empty");let r=t[0],e=n(r);for(let s of t){let i=n(s);i>e&&(e=i,r=s)}return r}function $(t){if(t.length===0)throw new Error("empty");return t.reduce((n,r)=>r.length>n.length?r:n)}var G="\u3041\u3042\u3043\u3044\u3045\u3046\u3047\u3048\u3049\u304A\u304B\u304C\u304D\u304E\u304F\u3050\u3051\u3052\u3053\u3054\u3055\u3056\u3057\u3058\u3059\u305A\u305B\u305C\u305D\u305E\u305F\u3060\u3061\u3062\u3063\u3064\u3065\u3066\u3067\u3068\u3069\u306A\u306B\u306C\u306D\u306E\u306F\u3070\u3071\u3072\u3073\u3074\u3075\u3076\u3077\u3078\u3079\u307A\u307B\u307C\u307E\u307F\u3080\u3081\u3082\u3083\u3084\u3085\u3086\u3087\u3088\u3089\u308A\u308B\u308C\u308D\u308E\u308F\u3090\u3091\u3092\u3093\u3094\u3095\u3096",w="\u30A1\u30A2\u30A3\u30A4\u30A5\u30A6\u30A7\u30A8\u30A9\u30AA\u30AB\u30AC\u30AD\u30AE\u30AF\u30B0\u30B1\u30B2\u30B3\u30B4\u30B5\u30B6\u30B7\u30B8\u30B9\u30BA\u30BB\u30BC\u30BD\u30BE\u30BF\u30C0\u30C1\u30C2\u30C3\u30C4\u30C5\u30C6\u30C7\u30C8\u30C9\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D0\u30D1\u30D2\u30D3\u30D4\u30D5\u30D6\u30D7\u30D8\u30D9\u30DA\u30DB\u30DC\u30DE\u30DF\u30E0\u30E1\u30E2\u30E3\u30E4\u30E5\u30E6\u30E7\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EE\u30EF\u30F0\u30F1\u30F2\u30F3\u30F4\u30F5\u30F6";if(G.length!==w.length)throw new Error("Kana strings not same length?");var O=new Map([]),q=new Map([]);G.split("").forEach((t,n)=>{O.set(w[n],t),q.set(t,w[n])});function p(t){return t.split("").map(n=>O.get(n)||n).join("")}function C(t,{textToKeys:n}){if(!t)return;let r=[];for(let e in n)t.startsWith(p(e))&&r.push(e);return r}function b(t,n){let r=p(t);return((C(r,n)??[]).flatMap(i=>n.textToKeys[i])??[]).map(i=>({firstKey:i,result:R(t,i,n)}))}function R(t,n,r){if(!t)return t;let{keyToNext:e,keyToText:s}=r,i=s[n],o=p(i),f=p(t);if(!f.startsWith(o))throw new Error("bad startKey");let g=e[n]?.filter(l=>f.startsWith(o+p(s[l])))??[],a=t.slice(0,i.length);if(g.length===0)return a;let m=t.slice(i.length),d=g.map(l=>R(m,l,r));return a+$(d)}function X(t,n){let r=[],e=t;for(;e;){let s=b(e,n);if(s.length===0)r.push({text:e[0],status:"unknown",start:!1}),e=e.slice(1);else{let i=M(s,o=>o.result.length);r.push({text:i.result,status:"ok",start:n.ancestorKeys[i.firstKey]}),e=e.slice(i.result.length)}}return r}function U(t){let n=t.furigana.map(s=>typeof s=="string"?s:s.ruby),r=n.join(""),e=n.flatMap((s,i)=>Array.from({length:s.length},()=>i));for(let[s]of t.synonyms??[]){let i=r.indexOf(s);if(i<0)return!1;let o=i+s.length-1;if(i>0&&e[i]===e[i-1]||o<r.length-1&&e[o]===e[o+1])return!1}return!0}function D(t,n,r){let e=t.furigana.map(o=>typeof o=="string"?o:o.ruby),s=e.join(""),i=e.flatMap((o,f)=>Array.from({length:o.length},()=>f));for(let[o,f]of t.synonyms??[]){let g=K(s,o);if(g.length===0)throw new Error("synonym not found in raw sentence? "+o);for(let a of g){let m=a+o.length-1,d=i[a],l=i[m],y=T(t,d).flatMap(c=>r[c]??[]);for(let[c,h]of f.entries())y=v({f:h,fidx:`${o}/${a}/${c}`,previousKeys:y,textToKeys:n,keyToPrev:r});if(t.furigana[l+1])for(let c of T(t,l+1))for(let h of y)u(r,c,h);let S=T(t,l),j=Object.entries(r).filter(([,c])=>S.some(h=>c.includes(h))).map(([c])=>c);for(let c of j)for(let h of y)u(r,c,h,H)}}}var H=!0;function T(t,n){if(n<0||n>=t.furigana.length)throw new Error("weird index");let r=t.furigana[n];return typeof r=="string"?[`${r}/${n}`]:[`${r.rt}/${n}`,`${r.ruby}/${n}`]}function v({f:t,fidx:n,previousKeys:r,textToKeys:e,keyToPrev:s}){if(typeof t=="string"){let o=`${t}/${n}`;u(e,t,o);for(let f of r)u(s,o,f);return[o]}let i=[];{let o=`${t.ruby}/${n}`;u(e,t.ruby,o);for(let f of r)u(s,o,f);i.push(o)}{let o=`${t.rt}/${n}`;u(e,t.rt,o);for(let f of r)u(s,o,f);i.push(o)}return i}function _(t){if(!U(t))throw new Error("Invalid synonyms");let n={},r={},e=[];for(let[a,m]of t.furigana.entries())e=v({f:m,fidx:a,previousKeys:e,textToKeys:n,keyToPrev:r});D(t,n,r);let s=k(r),i=E(n),o=Object.keys(i),f=Object.fromEntries(o.filter(a=>!(a in r)||r[a].length===0).map(a=>[a,!0])),g=Object.fromEntries(o.filter(a=>!(a in s)||s[a].length===0).map(a=>[a,!0]));return{textToKeys:n,keyToPrev:r,keyToText:i,keyToNext:s,ancestorKeys:f,leafKeys:g}}return N(B);})();
//# sourceMappingURL=tabito.min.js.map
