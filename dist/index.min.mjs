function u(t,n,r,e=!1){n in t||(t[n]=[]),(!e||!t[n].includes(r))&&t[n].push(r)}function b(t){let n={};for(let r in t)for(let e of t[r])u(n,e,r);return n}function T(t){let n={};for(let r in t)for(let e of t[r]){if(e in n)throw new Error("non-unique values");n[e]=r}return n}function k(t,n){let r=[],e=-1;for(;(e=t.indexOf(n,e+1))>=0;)r.push(e);return r}function K(t,n){if(t.length===0)throw new Error("empty");let r=t[0],e=n(r);for(let i of t){let o=n(i);o>e&&(e=o,r=i)}return r}function M(t){if(t.length===0)throw new Error("empty");return t.reduce((n,r)=>r.length>n.length?r:n)}var $="\u3041\u3042\u3043\u3044\u3045\u3046\u3047\u3048\u3049\u304A\u304B\u304C\u304D\u304E\u304F\u3050\u3051\u3052\u3053\u3054\u3055\u3056\u3057\u3058\u3059\u305A\u305B\u305C\u305D\u305E\u305F\u3060\u3061\u3062\u3063\u3064\u3065\u3066\u3067\u3068\u3069\u306A\u306B\u306C\u306D\u306E\u306F\u3070\u3071\u3072\u3073\u3074\u3075\u3076\u3077\u3078\u3079\u307A\u307B\u307C\u307E\u307F\u3080\u3081\u3082\u3083\u3084\u3085\u3086\u3087\u3088\u3089\u308A\u308B\u308C\u308D\u308E\u308F\u3090\u3091\u3092\u3093\u3094\u3095\u3096",w="\u30A1\u30A2\u30A3\u30A4\u30A5\u30A6\u30A7\u30A8\u30A9\u30AA\u30AB\u30AC\u30AD\u30AE\u30AF\u30B0\u30B1\u30B2\u30B3\u30B4\u30B5\u30B6\u30B7\u30B8\u30B9\u30BA\u30BB\u30BC\u30BD\u30BE\u30BF\u30C0\u30C1\u30C2\u30C3\u30C4\u30C5\u30C6\u30C7\u30C8\u30C9\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D0\u30D1\u30D2\u30D3\u30D4\u30D5\u30D6\u30D7\u30D8\u30D9\u30DA\u30DB\u30DC\u30DE\u30DF\u30E0\u30E1\u30E2\u30E3\u30E4\u30E5\u30E6\u30E7\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EE\u30EF\u30F0\u30F1\u30F2\u30F3\u30F4\u30F5\u30F6";if($.length!==w.length)throw new Error("Kana strings not same length?");var E=new Map([]),v=new Map([]);$.split("").forEach((t,n)=>{E.set(w[n],t),v.set(t,w[n])});function p(t){return t.split("").map(n=>E.get(n)||n).join("")}function F(t,{textToKeys:n}){if(!t)return;let r=[];for(let e in n)t.startsWith(p(e))&&r.push(e);return r}function G(t,n){let r=p(t);return((F(r,n)??[]).flatMap(o=>n.textToKeys[o])??[]).map(o=>({firstKey:o,result:S(t,o,n)}))}function S(t,n,r){if(!t)return t;let{keyToNext:e,keyToText:i}=r,o=i[n],s=p(o),a=p(t);if(!a.startsWith(s))throw new Error("bad startKey");let g=e[n]?.filter(l=>a.startsWith(s+p(i[l])))??[],f=t.slice(0,o.length);if(g.length===0)return f;let y=t.slice(o.length),d=g.map(l=>S(y,l,r));return f+M(d)}function j(t,n){let r=[],e=t;for(;e;){let i=G(e,n);if(i.length===0)r.push({text:e[0],status:"unknown",start:!1}),e=e.slice(1);else{let o=K(i,s=>s.result.length);r.push({text:o.result,status:"ok",start:n.ancestorKeys.has(o.firstKey)}),e=e.slice(o.result.length)}}return r}function A(t){let n=t.furigana.map(i=>typeof i=="string"?i:i.ruby),r=n.join(""),e=n.flatMap((i,o)=>Array.from({length:i.length},()=>o));for(let[i]of t.synonyms??[]){let o=r.indexOf(i);if(o<0)return!1;let s=o+i.length-1;if(o>0&&e[o]===e[o-1]||s<r.length-1&&e[s]===e[s+1])return!1}return!0}function W(t,n,r){let e=t.furigana.map(s=>typeof s=="string"?s:s.ruby),i=e.join(""),o=e.flatMap((s,a)=>Array.from({length:s.length},()=>a));for(let[s,a]of t.synonyms??[]){let g=k(i,s);if(g.length===0)throw new Error("synonym not found in raw sentence? "+s);for(let f of g){let y=f+s.length-1,d=o[f],l=o[y],m=x(t,d).flatMap(c=>r[c]??[]);for(let[c,h]of a.entries())m=O({f:h,fidx:`${s}/${f}/${c}`,previousKeys:m,textToKeys:n,keyToPrev:r});if(t.furigana[l+1])for(let c of x(t,l+1))for(let h of m)u(r,c,h);let R=x(t,l),X=Object.entries(r).filter(([,c])=>R.some(h=>c.includes(h))).map(([c])=>c);for(let c of X)for(let h of m)u(r,c,h,Y)}}}var Y=!0;function x(t,n){if(n<0||n>=t.furigana.length)throw new Error("weird index");let r=t.furigana[n];return typeof r=="string"?[`${r}/${n}`]:[`${r.rt}/${n}`,`${r.ruby}/${n}`]}function O({f:t,fidx:n,previousKeys:r,textToKeys:e,keyToPrev:i}){if(typeof t=="string"){let s=`${t}/${n}`;u(e,t,s);for(let a of r)u(i,s,a);return[s]}let o=[];{let s=`${t.ruby}/${n}`;u(e,t.ruby,s);for(let a of r)u(i,s,a);o.push(s)}{let s=`${t.rt}/${n}`;u(e,t.rt,s);for(let a of r)u(i,s,a);o.push(s)}return o}function H(t){if(!A(t))throw new Error("Invalid synonyms");let n={},r={},e=[];for(let[f,y]of t.furigana.entries())e=O({f:y,fidx:f,previousKeys:e,textToKeys:n,keyToPrev:r});W(t,n,r);let i=b(r),o=T(n),s=Object.keys(o),a=new Set(s.filter(f=>!(f in r)||r[f].length===0)),g=new Set(s.filter(f=>!(f in i)||i[f].length===0));return{textToKeys:n,keyToPrev:r,keyToText:o,keyToNext:i,ancestorKeys:a,leafKeys:g}}export{G as _findGreedyPath,j as chunkInput,H as sentenceToGraph};
//# sourceMappingURL=index.min.mjs.map
